System.register(["./phaser-legacy-DiYnME_r.js"],function(t,e){"use strict";var s;return{setters:[t=>{s=t.P}],execute:function(){class t extends s.Scene{constructor(){super("BootScene")}preload(){this.load.image("player","/Schwerterschlag/assets/images/Held.png"),this.load.on("loaderror",t=>{console.warn(`Failed to load: ${t.key}`)})}create(){this.scene.start("GameScene")}}class e{constructor(t){this.scene=t,this.keys={},this.touchState={active:!1,x:0,y:0,startX:0,startY:0},this.setupKeyboard(),this.setupTouch()}setupKeyboard(){this.keys=this.scene.input.keyboard.addKeys({up:"W",down:"S",left:"A",right:"D",attack:"SPACE",defend:"SHIFT"})}setupTouch(){this.scene.input.on("pointerdown",this.handleTouchStart,this),this.scene.input.on("pointermove",this.handleTouchMove,this),this.scene.input.on("pointerup",this.handleTouchEnd,this)}handleTouchStart(t){this.touchState.active=!0,this.touchState.startX=t.x,this.touchState.startY=t.y,this.touchState.x=t.x,this.touchState.y=t.y}handleTouchMove(t){this.touchState.x=t.x,this.touchState.y=t.y}handleTouchEnd(t){this.touchState.active=!1}getMovementDirection(){let t=0,e=0;if(this.keys.left.isDown&&(t-=1),this.keys.right.isDown&&(t+=1),this.keys.up.isDown&&(e-=1),this.keys.down.isDown&&(e+=1),this.touchState.active){const s=this.touchState.x-this.touchState.startX,i=this.touchState.y-this.touchState.startY,a=30;Math.abs(s)>a&&(t=Math.sign(s)),Math.abs(i)>a&&(e=Math.sign(i))}const s=Math.sqrt(t*t+e*e);return s>0&&(t/=s,e/=s),{x:t,y:e}}isAttacking(){return this.keys.attack.isDown||this.scene.input.activePointer.isDown}isDefending(){return this.keys.defend.isDown}}class i extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s){super(t,e,s,"player"),t.add.existing(this),t.physics.add.existing(this),this.stats={hp:100,maxHp:100,speed:200,attackDamage:15,attackCooldown:400,defendReduction:.5},this.state={isAttacking:!1,isDefending:!1,canAttack:!0,knockbackVelocity:{x:0,y:0}},this.setCollideWorldBounds(!0),this.setBounce(.1),this.setDrag(.99),this.setScale(.8),this.setDisplayOrigin(16,24)}update(t){const e=t.getMovementDirection();this.setVelocity(e.x*this.stats.speed,e.y*this.stats.speed),this.state.isAttacking=t.isAttacking(),this.state.isDefending=t.isDefending(),this.state.isAttacking&&this.state.canAttack&&this.performAttack(),0===this.state.knockbackVelocity.x&&0===this.state.knockbackVelocity.y||(this.setVelocity(this.state.knockbackVelocity.x,this.state.knockbackVelocity.y),this.state.knockbackVelocity.x*=.9,this.state.knockbackVelocity.y*=.9)}performAttack(){this.state.canAttack=!1,this.state.isAttacking=!0,this.setScale(.9),this.scene.time.delayedCall(100,()=>{this.setScale(.8)}),this.scene.time.delayedCall(this.stats.attackCooldown,()=>{this.state.canAttack=!0}),this.scene.events.emit("player-attack",{x:this.x,y:this.y,damage:this.stats.attackDamage,direction:this.getDirection()})}getDirection(){const t=Math.atan2(this.body.velocity.y,this.body.velocity.x);return{x:Math.cos(t),y:Math.sin(t)}}takeDamage(t){const e=this.state.isDefending?t*this.stats.defendReduction:t;return this.stats.hp-=e,this.scene.cameras.main.shake(150,.005),this.stats.hp<=0}applyKnockback(t,e,s=300){this.state.knockbackVelocity.x=t*s,this.state.knockbackVelocity.y=e*s}heal(t){this.stats.hp=Math.min(this.stats.hp+t,this.stats.maxHp)}}class a extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s,i="basic"){super(t,e,s,"enemy"),t.add.existing(this),t.physics.add.existing(this),this.type=i,this.stats=this.getStatsForType(i),this.state={isAttacking:!1,canAttack:!0,target:null,knockbackVelocity:{x:0,y:0}},this.setCollideWorldBounds(!0),this.setBounce(.1),this.setTint(16711680),this.displayWidth=32,this.displayHeight=48,this.aiTimer=0,this.aiDecisionInterval=Phaser.Math.Between(1e3,2e3)}getStatsForType(t){const e={basic:{hp:30,maxHp:30,speed:120,attackDamage:10,attackCooldown:800,attackRange:50,detectionRange:300},strong:{hp:60,maxHp:60,speed:100,attackDamage:20,attackCooldown:1e3,attackRange:60,detectionRange:400}};return e[t]||e.basic}update(t,e){this.aiTimer+=16,this.state.target=t;const s=Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y);s<this.stats.detectionRange?(this.pursueTarget(t),s<this.stats.attackRange&&this.state.canAttack&&this.performAttack(t)):this.aiTimer>this.aiDecisionInterval&&(this.setVelocity(Phaser.Math.Between(-100,100),Phaser.Math.Between(-100,100)),this.aiTimer=0,this.aiDecisionInterval=Phaser.Math.Between(1e3,2e3)),0===this.state.knockbackVelocity.x&&0===this.state.knockbackVelocity.y||(this.setVelocity(this.state.knockbackVelocity.x,this.state.knockbackVelocity.y),this.state.knockbackVelocity.x*=.9,this.state.knockbackVelocity.y*=.9),this.avoidOtherEnemies(e)}pursueTarget(t){const e=Math.atan2(t.y-this.y,t.x-this.x);this.setVelocity(Math.cos(e)*this.stats.speed,Math.sin(e)*this.stats.speed)}performAttack(t){this.state.canAttack=!1,this.state.isAttacking=!0,this.setTint(16755200),this.scene.time.delayedCall(200,()=>{this.setTint(16711680)});const e=Math.atan2(t.y-this.y,t.x-this.x);this.scene.events.emit("enemy-attack",{x:this.x,y:this.y,damage:this.stats.attackDamage,direction:{x:Math.cos(e),y:Math.sin(e)},source:this}),this.scene.time.delayedCall(this.stats.attackCooldown,()=>{this.state.canAttack=!0})}avoidOtherEnemies(t){let e=0,s=0;if(t.forEach(t=>{if(t!==this&&Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y)<40){const i=Math.atan2(this.y-t.y,this.x-t.x);e+=Math.cos(i),s+=Math.sin(i)}}),0!==e||0!==s){const t=Math.sqrt(e*e+s*s);this.body.velocity.x+=e/t*50,this.body.velocity.y+=s/t*50}}takeDamage(t){return this.stats.hp-=t,this.setTint(16776960),this.scene.time.delayedCall(100,()=>{this.setTint(16711680)}),this.stats.hp<=0}applyKnockback(t,e,s=300){this.state.knockbackVelocity.x=t*s,this.state.knockbackVelocity.y=e*s}}class h{constructor(t){this.scene=t,this.activeAttacks=[],this.scene.events.on("player-attack",this.handlePlayerAttack,this),this.scene.events.on("enemy-attack",this.handleEnemyAttack,this)}handlePlayerAttack(t){const e={x:t.x,y:t.y,damage:t.damage,direction:t.direction,radius:60,lifetime:300,age:0,source:"player"};this.activeAttacks.push(e),this.visualizeAttack(e)}handleEnemyAttack(t){const e={x:t.x,y:t.y,damage:t.damage,direction:t.direction,radius:50,lifetime:300,age:0,source:"enemy",sourceEntity:t.source};this.activeAttacks.push(e),this.visualizeAttack(e)}visualizeAttack(t){const e=this.scene.add.circle(t.x,t.y,t.radius,"player"===t.source?65280:16711680,.3);this.scene.tweens.add({targets:e,alpha:0,duration:t.lifetime,onComplete:()=>e.destroy()})}update(t,e){this.activeAttacks=this.activeAttacks.filter(t=>(t.age+=16,t.age<t.lifetime)),this.activeAttacks.filter(t=>"player"===t.source).forEach(t=>{e.forEach(e=>{if(this.isHit(t,e)){const s=e.takeDamage(t.damage),i=Math.atan2(e.y-t.y,e.x-t.x);e.applyKnockback(Math.cos(i),Math.sin(i)),s&&this.scene.events.emit("enemy-defeated",{enemy:e})}})}),this.activeAttacks.filter(t=>"enemy"===t.source).forEach(e=>{if(this.isHit(e,t)){const s=t.takeDamage(e.damage),i=Math.atan2(t.y-e.y,t.x-e.x);t.applyKnockback(Math.cos(i),Math.sin(i)),s&&this.scene.events.emit("player-defeated")}})}isHit(t,e){return Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y)<t.radius+16}clear(){this.activeAttacks=[]}}class n{constructor(t){this.scene=t,this.currentWave=1,this.enemiesSpawned=0,this.waveActive=!1}startWave(t){this.waveActive=!0;const e=2+this.currentWave;this.generateSpawnPositions(t,e).forEach((t,e)=>{this.scene.time.delayedCall(300*e,()=>{this.scene.events.emit("spawn-enemy",{x:t.x,y:t.y,type:this.currentWave>3?"strong":"basic"}),this.enemiesSpawned+=1})})}generateSpawnPositions(t,e){const s=[];for(let i=0;i<e;i++){const a=i/e*Math.PI*2;s.push({x:t.x+400*Math.cos(a),y:t.y+400*Math.sin(a)})}return s}nextWave(){this.currentWave+=1,this.enemiesSpawned=0,this.waveActive=!1}isWaveComplete(t){return this.waveActive&&0===t&&this.enemiesSpawned>0}}class c{constructor(t){this.scene=t,this.score=0,this.wave=1,this.enemiesDefeated=0,this.setupUI(),this.setupEvents()}setupUI(){const t=this.scene.make.graphics({x:0,y:0,add:!1});t.fillStyle(0,.7),t.fillRect(0,0,this.scene.scale.width,80),t.generateTexture("hudBg",this.scene.scale.width,80),t.destroy(),this.hudBg=this.scene.add.image(0,0,"hudBg"),this.hudBg.setOrigin(0,0),this.hudBg.setScrollFactor(0),this.hudBg.setDepth(100),this.scoreText=this.scene.add.text(20,15,"Score: 0",{fontSize:"20px",fill:"#00ff00",fontFamily:"Arial"}),this.scoreText.setScrollFactor(0).setDepth(101),this.waveText=this.scene.add.text(20,45,"Wave: 1",{fontSize:"20px",fill:"#00ff00",fontFamily:"Arial"}),this.waveText.setScrollFactor(0).setDepth(101),this.hpText=this.scene.add.text(this.scene.scale.width-20,15,"HP: 100/100",{fontSize:"20px",fill:"#00ff00",fontFamily:"Arial",align:"right"}),this.hpText.setOrigin(1,0).setScrollFactor(0).setDepth(101),this.enemyCountText=this.scene.add.text(this.scene.scale.width-20,45,"Enemies: 0",{fontSize:"20px",fill:"#00ff00",fontFamily:"Arial",align:"right"}),this.enemyCountText.setOrigin(1,0).setScrollFactor(0).setDepth(101)}setupEvents(){this.scene.events.on("enemy-defeated",t=>{this.score+=100,this.enemiesDefeated+=1,this.update()}),this.scene.events.on("player-defeated",()=>{this.showGameOver()})}update(t=null,e=0){this.scoreText.setText(`Score: ${this.score}`),this.waveText.setText(`Wave: ${this.wave}`),this.enemyCountText.setText(`Enemies: ${e}`),t&&this.hpText.setText(`HP: ${Math.max(0,t.stats.hp)}/${t.stats.maxHp}`)}showGameOver(){this.scene.add.text(this.scene.scale.width/2,this.scene.scale.height/2,`GAME OVER\nScore: ${this.score}\nEnemies Defeated: ${this.enemiesDefeated}`,{fontSize:"48px",fill:"#ff0000",fontFamily:"Arial",align:"center"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(200),this.scene.add.text(this.scene.scale.width/2,this.scene.scale.height/2+150,"Press SPACE to restart",{fontSize:"24px",fill:"#ffff00",fontFamily:"Arial",align:"center"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(200),this.scene.isGameOver=!0}nextWave(){this.wave+=1}}class o extends s.Scene{constructor(){super("GameScene")}create(){this.cameras.main.setBackgroundColor("#1a1a2e"),this.player=new i(this,400,300),this.enemies=[],this.isGameOver=!1,this.inputManager=new e(this),this.combatSystem=new h(this),this.waveManager=new n(this),this.uiManager=new c(this),this.setupEvents(),this.time.delayedCall(1e3,()=>{this.waveManager.startWave(this.player)})}setupEvents(){this.events.on("spawn-enemy",t=>{const e=new a(this,t.x,t.y,t.type);this.enemies.push(e)}),this.events.on("enemy-defeated",t=>{const e=this.enemies.indexOf(t.enemy);e>-1&&(this.enemies.splice(e,1),t.enemy.destroy()),this.waveManager.isWaveComplete(this.enemies.length)&&(this.waveManager.nextWave(),this.uiManager.nextWave(),this.time.delayedCall(2e3,()=>{this.waveManager.startWave(this.player)}))}),this.events.on("player-defeated",()=>{this.handleGameOver()}),this.input.keyboard.on("keydown-SPACE",()=>{this.isGameOver&&this.scene.restart()}),this.input.on("pointerdown",()=>{this.isGameOver&&this.scene.restart()})}update(){this.isGameOver||(this.player.update(this.inputManager),this.enemies.forEach(t=>{t.update(this.player,this.enemies)}),this.combatSystem.update(this.player,this.enemies),this.cameras.main.centerOn(this.player.x,this.player.y),this.uiManager.update(this.player,this.enemies.length))}handleGameOver(){this.isGameOver=!0}}const r={type:s.AUTO,parent:"game-container",physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scale:{mode:s.Scale.FIT,autoCenter:s.Scale.CENTER_BOTH,width:1024,height:768,min:{width:320,height:240},max:{width:1920,height:1440}},scene:[t,o],render:{pixelArt:!0,antialias:!1}},l=new s.Game(r);window.addEventListener("resize",()=>{l.scale.refresh()})}}});
